name: DXF to DWG CI

on:
  push:
    branches: ["development"]
  pull_request:
    branches: ["development"]

jobs:
  test-dxf:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Install dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y xvfb libfuse2

      - name: Prepare ODA AppImage
        run: |
          mkdir -p bin
          # Move your ODAFileConverter AppImage to bin/
          mv ODAFileConverter_QT6_lnxX64_8.3dll_26.10.AppImage bin/
          chmod +x bin/ODAFileConverter_QT6_lnxX64_8.3dll_26.10.AppImage

      - name: Create test DXF
        run: |
          mkdir -p tmp dwg_out
          echo -e "0\nSECTION\n2\nHEADER\n0\nENDSEC\n0\nSECTION\n2\nTABLES\n0\nENDSEC\n0\nSECTION\n2\nBLOCKS\n0\nENDSEC\n0\nSECTION\n2\nENTITIES\n0\nLINE\n8\n0\n10\n0\n20\n0\n11\n100\n21\n100\n0\nENDSEC\n0\nSECTION\n2\nOBJECTS\n0\nENDSEC\n0\nEOF" > tmp/test.dxf

      - name: Run ODA conversion
        run: |
          xvfb-run bin/ODAFileConverter_QT6_lnxX64_8.3dll_26.10.AppImage \
            tmp/test.dxf dwg_out ACAD2018 DWG 0 1

      - name: List converted files
        run: ls -la dwg_out