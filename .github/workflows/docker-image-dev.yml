name: DXF to DWG CI

on:
  push:
    branches: ["development"]
  pull_request:
    branches: ["development"]

jobs:
  test-dxf:
    runs-on: self-hosted   # your own runner

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Install dependencies
        run: sudo apt-get update && sudo apt-get install -y xvfb

      - name: Prepare directories
        run: |
          mkdir -p tmp dwg_out

      - name: Create test DXF
        run: |
          echo -e "0\nSECTION\n2\nHEADER\n0\nENDSEC\n0\nSECTION\n2\nTABLES\n0\nENDSEC\n0\nSECTION\n2\nBLOCKS\n0\nENDSEC\n0\nSECTION\n2\nENTITIES\n0\nLINE\n8\n0\n10\n0\n20\n0\n11\n100\n21\n100\n0\nENDSEC\n0\nSECTION\n2\nOBJECTS\n0\nENDSEC\n0\nEOF" > tmp/test.dxf

      - name: Extract ODA AppImage
        run: |
          chmod +x bin/ODAFileConverter_QT6_lnxX64_8.3dll_26.10.AppImage
          ./bin/ODAFileConverter_QT6_lnxX64_8.3dll_26.10.AppImage --appimage-extract

      - name: Run DXF to DWG conversion
        run: |
          xvfb-run ./squashfs-root/usr/bin/ODAFileConverter /tmp/test.dxf /dwg_out ACAD2018 DWG 0 1

      - name: List converted files
        run: ls -la dwg_out